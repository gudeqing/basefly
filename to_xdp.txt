(1) 需求大致描述：
    我现在有一套自建的写pipeline方法，通过这套方法写了2个大的常用分析流程：dnaseq和rnaseq流程。
    现在需要在xdp上部署这些流程并且能够发布到应用广场给客户使用。
    具体要求：
    1. 流程在运行过程中会实时生成运行状态图(SVG格式，后缀改为html可以在XDP预览)，所以希望流程在运行时，客户也能在项目空间中实时看到这个图从而快速判断流程运行状态。
    2. 希望流程是直接在外挂盘运行: /root/attach_storage/
    3. 流程运行完成后，结果复制到local_storage (如果能够提供参数指定将输出结果复制到项目空间的某个目录会更好)
    4. 最后，希望能够在研发同事的帮助下，实现新的类似流程部署。

    理由：
    由于平台上实际使用客户增多，如厦大、中肿、索真等，技术支持工作明显增多，需要优化和完善平台上的应用从而提升用户体验和售后支持效率。
    当前的dnaseq流程可以做germline突变分析，也可以做somatic突变分析，并且支持大批量样本并行分析，可以替代平台上的两个sentieon应用“DNAseq”和“TNSeq”.
    当前的RNAseq流程是对平台上生信分析流程的补充，因为平台上目前没有一个完整全面RNAseq分析流程。
    相信这些新流程可以大大方便用户分析，从而可以减少我的售前、售后支持工作。
    测试没有问题后，我希望可以向客户推荐我的编写流程的方法baseflow)，方便协助客户开发和部署自己的流程。当然WDL应用的支持仍然需要继续，后续可能还要平台支持Nextflow。

(3) 现状/背景
    我当前可以在xdp上通过docker runner运行自己的流程，并且已经用来分析了500+样本，大概过程例如：
    1. 加载 danseq流程的docker镜像，该镜像包含了流程运行需要的所有软件
    2. 运行脚本：
        cd /root/attach_storage/
        python dnaseq.py -run -input xxxx
        cp Result /enigma/local_storage

# DNAseq流程参数说明如下，不同流程的参数会不大一样，因此需要
$ python PycharmProjects/nestcmd/TNSeq/dnaseq.py -h
usage: dnaseq.py [-h] [--run] [--docker] [--plot] [-dump_args dump-args] [-update_args update-args] [-threads max-workers] [-outdir workdir]
                 [-skip step1 [task3 ...]] [-rerun_steps task3 [task_prefix ...]] [-retry max-retry] [--list_cmd] [-show_cmd cmd-query]
                 [--list_task] [--monitor_resource] [-wait_resource_time wait-time] [--no_check_resource_before_run] -fastq_info FASTQ_INFO
                 [FASTQ_INFO ...] [-r1_name R1_NAME] [-r2_name R2_NAME] [-exclude_samples EXCLUDE_SAMPLES [EXCLUDE_SAMPLES ...]] -pair_info
                 PAIR_INFO [-sentieon_threads SENTIEON_THREADS] [--realign] -ref REF -dbsnp DBSNP -known_indels KNOWN_INDELS -known_mills
                 KNOWN_MILLS [-pon PON] [-germline_vcf GERMLINE_VCF] [-vep_cache_dir VEP_CACHE_DIR] [-vep_plugin_dir VEP_PLUGIN_DIR]
                 [-intervals INTERVALS] [-hisatgenotype_db HISATGENOTYPE_DB]

typical bioinformatics pipeline using sentieon TNSeq and VEP, including HLA-typing

optional arguments:
  -h, --help            show this help message and exit
  -fastq_info FASTQ_INFO [FASTQ_INFO ...]
                        A list with elements from [fastq file, fastq parent dir, fastq_info.txt, fastq_info.json] (default: None)
  -r1_name R1_NAME      python regExp that describes the full name of read1 fastq file name. It requires at least one pair small brackets, and
                        the string matched in the first pair brackets will be used as sample name. Example: '(.*).R1.fq.gz' (default:
                        (.*).R1.fastq)
  -r2_name R2_NAME      python regExp that describes the full name of read2 fastq file name. It requires at least one pair small brackets, and
                        the string matched in the first pair brackets will be used as sample name. Example: '(.*).R2.fq.gz' (default:
                        (.*).R2.fastq)
  -exclude_samples EXCLUDE_SAMPLES [EXCLUDE_SAMPLES ...]
                        samples to exclude from analysis (default: ())
  -pair_info PAIR_INFO  tumor normal pair info, two-column txt file, first column is tumor sample name. sample not in pair info will be
                        skipped (default: None)
  -sentieon_threads SENTIEON_THREADS
                        threads number used in sentieon (default: 4)
  --realign             if to realign indel region (default: False)
  -ref REF              reference fasta file, require bwa index being created (default: None)
  -dbsnp DBSNP          dbsnp vcf file (default: None)
  -known_indels KNOWN_INDELS
                        high confidence known indel vcf file (default: None)
  -known_mills KNOWN_MILLS
                        high confidence known indel vcf file (default: None)
  -pon PON              panel of normal vcf file for germline variant filtering, this will be required for tumor only analysis (default: None)
  -germline_vcf GERMLINE_VCF
                        germline vcf, will be used for germline variant filtering and contamination analysis (default: None)
  -vep_cache_dir VEP_CACHE_DIR
                        VEP cache directory (default: None)
  -vep_plugin_dir VEP_PLUGIN_DIR
                        VEP plugin directory (default: None)
  -intervals INTERVALS  interval file, support bed file or picard interval or vcf format. 如果不提供该参数，建议跳过coverage分析 (default: None)
  -hisatgenotype_db HISATGENOTYPE_DB
                        indicies dir of hisat-genotype for HLA typing (default: None)

Arguments for controlling running mode:
  --run                 运行流程，默认不运行, 仅生成流程，如果outdir目录已经存在cmd_state.txt文件，则自动续跑 (default: False)
  --docker              default won't use docker even if docker image is provided. (default: False)
  --plot                generate directed acyclic graph for whole workflow timely (default: False)
  -dump_args dump-args  输出参数配置json文件, 其包含流程所有软件需要的参数 (default: None)
  -update_args update-args
                        输入参数配置文件, 其包含流程所有软件需要的参数，该配置文件设置的参数值将是流程中最后实际用的值 (default: None)
  -threads max-workers  允许的最大并行的cmd数目, 默认5 (default: 5)
  -outdir workdir       分析目录或结果目录 (default: /home/danny.gu/Result)
  -skip step1 [task3 ...]
                        指定要跳过的步骤或具体task,空格分隔,程序会自动跳过依赖他们的步骤, 使用--list_cmd or --list_task可查看候选 (default: [])
  -rerun_steps task3 [task_prefix ...]
                        指定需要重跑的步骤，不论其是否已经成功完成，空格分隔, 这样做的可能原因可以是: 你重新设置了参数. 使用--list_task可查看候选，也可以使用task的前缀指定属于同一个步骤的task (default: [])
  -retry max-retry      某步骤运行失败后再尝试运行的次数, 默认1次. 如需对某一步设置不同的值, 可在运行流程前修改pipeline.ini (default: 1)
  --list_cmd            仅仅显示当前流程包含的主步骤, 且已经排除指定跳过的步骤 (default: False)
  -show_cmd cmd-query   提供一个cmd名称,输出该cmd的样例 (default: None)
  --list_task           仅仅显示当前流程包含的详细步骤, 且已经排除指定跳过的步骤 (default: False)
  --monitor_resource    是否监控每一步运行时的资源消耗, 如需对某一步设置不同的值, 可在运行流程前修改pipeline.ini (default: False)
  -wait_resource_time wait-time
                        等待资源的时间上限, 默认每次等待时间为15秒, 等待时间超过这个时间且资源不足时判定任务失败 (default: 60)
  --no_check_resource_before_run
                        指示运行某步骤前检测指定的资源是否足够, 如不足, 则该步骤失败; 如果设置该参数, 则运行前不检查资源. 如需对某一步设置不同的值,可运行前修改pipeline.ini. 如需更改指定的资源,
                        可在运行流程前修改pipeline.ini (default: False)

